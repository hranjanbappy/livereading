<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text-to-Speech with Voice Selection</title>
  <style>
    .responsive-pre {
      white-space: pre-wrap;
      font-family: 'Indie Flower', cursive;
      font-size: 1.5em;
      color: #333;
      background-color: #f9f9f9;
      padding: 20px;
      border: 2px solid #ccc;
      border-radius: 10px;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: left;
      margin: 0 auto;
      text-align: center;
    }

    .button-container {
      text-align: center;
      margin: 20px 0;
    }

    button {
      font-size: 1em;
      padding: 10px 20px;
      margin: 0 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
    }

    button.stop {
      background-color: #dc3545;
    }

    button.listen {
      background-color: #28a745;
    }

    button.mute {
      background-color: #6c757d;
    }

    button:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="responsive-pre">
    <div style="display: inline-block; text-align: left;">
      <p id="demo"></p>
    </div>
  </div>

  <div class="button-container">
    <button onclick="startTypeWriter()">Start</button>
    <button class="stop" onclick="stopTypeWriter()">Stop</button>
    <button class="listen" onclick="restartTypeWriter()">Listen</button>
    <button class="mute" onclick="muteText()">Mute</button><br><br>
    <select id="voiceSelect"></select>
  </div>

  <script>
    var i = 0;
    var txt = `
    Hello Dear Friend - Welcome to our self learning platform.
    Where you can learn anything at your own time. 
    You can read and also take notes. 
    You can change the voice you like.
    
    Here is a nice poem for you.
    Title: Stopping by Woods on a Snowy Evening
    By Robert Frost.

    Whose woods these are I think I know.
    His house is in the village though;
    He will not see me stopping here
    To watch his woods fill up with snow.   
    
    My little horse must think it queer
    To stopwithout a farmhouse near
    Between the woods and frozen lake
    The darkest evening of the year.   
    
    He gives his harness bells a shake
    To ask if there is some mistake.
    The only other sound’s the sweep
    Of easy wind and downy flake.
    
    The woods are lovely, dark and deep,
    But I have promises to keep,
    And miles to go before I sleep,
    And miles to go before I sleep.

    Thank you.

 `;
    var speed = 70;
    var typingInterval;
    var speechSynthesis = window.speechSynthesis;
    var utterance;
    var isMuted = false;

    function startTypeWriterWithVoice() {
      if (!typingInterval) {
        typingInterval = setInterval(typeWriter, speed);
        if (!isMuted) {
          speakText(txt);
        }
      }
    }

    function startTypeWriter() {
      if (!typingInterval) {
        typingInterval = setInterval(typeWriter, speed);
      }
      if (speechSynthesis.speaking) {
        speechSynthesis.resume(); // Resume speech if paused
      }
    }

    function stopTypeWriter() {
      clearInterval(typingInterval);
      typingInterval = null;
      if (speechSynthesis.speaking) {
        speechSynthesis.pause(); // Pause ongoing speech
      }
    }

    function restartTypeWriter() {
      stopTypeWriter(); // Ensure typing is stopped
      i = 0; // Reset index
      document.getElementById("demo").innerHTML = ''; // Clear the text
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel(); // Stop any ongoing speech
      }
      startTypeWriterWithVoice(); // Start typing and speech again
    }

    function muteText() {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel(); // Cancel any ongoing speech
      }
    }

    function typeWriter() {
      if (i < txt.length) {
        document.getElementById("demo").innerHTML += txt.charAt(i);
        i++;
      } else {
        clearInterval(typingInterval);
        typingInterval = null;
      }
    }

    const voicesSelect = document.getElementById('voiceSelect');

    function populateVoiceList() {
      voices = speechSynthesis.getVoices();
      for (i = 0; i < voices.length; i++) {
        const option = document.createElement('option');
        option.textContent = voices[i].name + ' (' + voices[i].lang + ')';
        option.value = i;
        voicesSelect.add(option);
      }
    }

    speechSynthesis.addEventListener('voiceschanged', populateVoiceList);
    populateVoiceList();

    function speakText(text) {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel(); // Cancel any ongoing speech
      }
      utterance = new SpeechSynthesisUtterance(text);
      utterance.voice = voices[voicesSelect.value]; // Set the selected voice
      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
